# 待办事项应用技术架构文档

## 1. 项目概述

### 1.1 项目描述

一个现代化的待办事项管理应用，支持任务的增删改查、状态管理、筛选和批量操作功能。

### 1.2 技术栈

- **前端**: React 18 + TypeScript + CSS3
- **后端**: FastAPI + Python 3.9+
- **数据库**: SQLite
- **项目结构**: 前后端分离架构

## 2. 系统架构

### 2.1 整体架构图

```
┌─────────────────┐    HTTP/JSON    ┌─────────────────┐
│   React 前端    │ ◄─────────────► │  FastAPI 后端   │
│                 │                 │                 │
│ - 任务列表组件   │                 │ - REST API      │
│ - 表单组件      │                 │ - 数据验证      │
│ - 筛选组件      │                 │ - 业务逻辑      │
└─────────────────┘                 └─────────────────┘
                                              │
                                              ▼
                                    ┌─────────────────┐
                                    │   SQLite 数据库  │
                                    │                 │
                                    │ - tasks 表      │
                                    └─────────────────┘
```

### 2.2 目录结构

```
HA3/
├── backend/                 # 后端目录
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py         # FastAPI 应用入口
│   │   ├── models.py       # 数据模型
│   │   ├── database.py     # 数据库连接
│   │   ├── routers/        # API 路由
│   │   │   └── tasks.py    # 任务相关接口
│   │   └── schemas.py      # Pydantic 模型
│   ├── requirements.txt    # Python 依赖
│   └── database.db         # SQLite 数据库文件
└── frontend/               # 前端目录
    ├── public/
    ├── src/
    │   ├── components/     # React 组件
    │   │   ├── TaskList.tsx
    │   │   ├── TaskForm.tsx
    │   │   ├── TaskItem.tsx
    │   │   └── FilterBar.tsx
    │   ├── hooks/          # 自定义 Hooks
    │   │   └── useTasks.ts
    │   ├── services/       # API 服务
    │   │   └── api.ts
    │   ├── types/          # TypeScript 类型
    │   │   └── task.ts
    │   ├── App.tsx
    │   └── index.tsx
    ├── package.json
    └── tsconfig.json
```

## 3. 数据库设计

### 3.1 表结构设计

#### tasks 表

```sql
CREATE TABLE tasks (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(255) NOT NULL,
    completed BOOLEAN DEFAULT FALSE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 创建索引以提高查询性能
CREATE INDEX idx_tasks_completed ON tasks(completed);
CREATE INDEX idx_tasks_created_at ON tasks(created_at);
```

### 3.2 数据模型说明

| 字段名     | 类型         | 约束                      | 说明                    |
| ---------- | ------------ | ------------------------- | ----------------------- |
| id         | INTEGER      | PRIMARY KEY AUTOINCREMENT | 主键，自增整数          |
| title      | VARCHAR(255) | NOT NULL                  | 任务标题，最大 255 字符 |
| completed  | BOOLEAN      | DEFAULT FALSE             | 完成状态，布尔值        |
| created_at | DATETIME     | DEFAULT CURRENT_TIMESTAMP | 创建时间，自动生成      |
| updated_at | DATETIME     | DEFAULT CURRENT_TIMESTAMP | 更新时间，自动更新      |

## 4. API 接口设计

### 4.1 基础信息

- **Base URL**: `http://localhost:8000/api/v1`
- **Content-Type**: `application/json`
- **响应格式**: JSON

### 4.2 接口列表

#### 4.2.1 获取任务列表

```http
GET /tasks
```

**查询参数**:

- `status` (可选): `all` | `pending` | `completed`

**响应示例**:

```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "title": "学习 React",
      "completed": false,
      "created_at": "2025-01-27T10:00:00Z",
      "updated_at": "2025-01-27T10:00:00Z"
    }
  ],
  "total": 1
}
```

#### 4.2.2 创建任务

```http
POST /tasks
```

**请求体**:

```json
{
  "title": "学习 FastAPI"
}
```

**响应示例**:

```json
{
  "success": true,
  "data": {
    "id": 2,
    "title": "学习 FastAPI",
    "completed": false,
    "created_at": "2025-01-27T10:05:00Z",
    "updated_at": "2025-01-27T10:05:00Z"
  }
}
```

#### 4.2.3 更新任务状态

```http
PUT /tasks/{task_id}
```

**请求体**:

```json
{
  "completed": true
}
```

**响应示例**:

```json
{
  "success": true,
  "data": {
    "id": 1,
    "title": "学习 React",
    "completed": true,
    "created_at": "2025-01-27T10:00:00Z",
    "updated_at": "2025-01-27T10:10:00Z"
  }
}
```

#### 4.2.4 删除任务

```http
DELETE /tasks/{task_id}
```

**响应示例**:

```json
{
  "success": true,
  "message": "任务删除成功"
}
```

#### 4.2.5 批量删除已完成任务

```http
DELETE /tasks/completed
```

**响应示例**:

```json
{
  "success": true,
  "message": "已删除 3 个已完成的任务"
}
```

#### 4.2.6 清空所有任务

```http
DELETE /tasks/all
```

**响应示例**:

```json
{
  "success": true,
  "message": "已清空所有任务"
}
```

### 4.3 错误响应格式

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "任务标题不能为空",
    "details": {
      "field": "title",
      "value": ""
    }
  }
}
```

## 5. 前端组件设计

### 5.1 组件层次结构

```
App
├── TaskForm          # 任务输入表单
├── FilterBar         # 筛选和操作栏
└── TaskList          # 任务列表
    └── TaskItem      # 单个任务项
        ├── CompleteButton
        └── DeleteButton
```

### 5.2 组件职责

#### 5.2.1 TaskForm 组件

- 任务输入框
- 添加按钮
- 表单验证
- 提交处理

#### 5.2.2 TaskList 组件

- 任务列表渲染
- 空状态处理
- 加载状态

#### 5.2.3 TaskItem 组件

- 任务内容显示
- 完成状态切换
- 删除操作
- 样式状态管理

#### 5.2.4 FilterBar 组件

- 筛选按钮组（全部/未完成/已完成）
- 批量操作按钮（清除已完成/清除全部）

### 5.3 状态管理

使用 React Hooks 进行状态管理：

- `useState`: 本地组件状态
- `useEffect`: 副作用处理
- `useTasks`: 自定义 Hook 管理任务数据

## 6. 样式设计规范

### 6.1 设计原则

- 现代简洁的设计风格
- 响应式布局
- 良好的用户体验
- 无障碍访问支持

### 6.2 布局规范

- 主体容器：最大宽度 800px，居中显示
- 间距：统一的 16px 基础间距
- 圆角：8px 统一圆角
- 阴影：轻微阴影效果

### 6.3 颜色方案

```css
:root {
  --primary-color: #3b82f6;
  --success-color: #10b981;
  --danger-color: #ef4444;
  --text-primary: #1f2937;
  --text-secondary: #6b7280;
  --border-color: #e5e7eb;
  --background-color: #f9fafb;
}
```

### 6.4 交互效果

- 按钮悬停：颜色加深，轻微缩放
- 列表项悬停：背景色变化
- 过渡动画：0.2s ease-in-out

## 7. 开发环境配置

### 7.1 后端环境

```bash
# Python 环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或 venv\Scripts\activate  # Windows

# 安装依赖
pip install fastapi uvicorn sqlalchemy python-multipart
```

### 7.2 前端环境

```bash
# Node.js 环境
npx create-react-app frontend --template typescript
cd frontend
npm install axios
```

### 7.3 开发脚本

```json
// package.json
{
  "scripts": {
    "dev:backend": "uvicorn app.main:app --reload --host 0.0.0.0 --port 8000",
    "dev:frontend": "npm start",
    "build": "npm run build",
    "test": "npm test"
  }
}
```

## 8. 部署方案

### 8.1 开发环境

- 后端：`http://localhost:8000`
- 前端：`http://localhost:3000`
- 数据库：本地 SQLite 文件

### 8.2 生产环境建议

- 后端：Docker 容器化部署
- 前端：静态文件部署到 CDN
- 数据库：PostgreSQL 或 MySQL
- 反向代理：Nginx

## 9. 测试策略

### 9.1 后端测试

- 单元测试：使用 pytest
- API 测试：使用 FastAPI TestClient
- 数据库测试：使用测试数据库

### 9.2 前端测试

- 组件测试：使用 React Testing Library
- 集成测试：端到端测试
- 用户交互测试

## 10. 性能优化

### 10.1 后端优化

- 数据库索引优化
- API 响应缓存
- 分页查询
- 连接池管理

### 10.2 前端优化

- 组件懒加载
- 虚拟滚动（大量数据时）
- 防抖处理
- 本地状态缓存

## 11. 安全考虑

### 11.1 数据验证

- 输入数据验证
- SQL 注入防护
- XSS 防护

### 11.2 API 安全

- CORS 配置
- 请求频率限制
- 错误信息脱敏

## 12. 扩展性考虑

### 12.1 功能扩展

- 任务分类标签
- 任务优先级
- 任务截止时间
- 任务搜索功能

### 12.2 技术扩展

- 用户认证系统
- 多用户支持
- 实时同步
- 移动端适配

---

_本文档版本：v1.0_  
_最后更新：2025-01-27_
